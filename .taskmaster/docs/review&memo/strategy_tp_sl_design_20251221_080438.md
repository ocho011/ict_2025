# 전략 설계 검토 메모: TP/SL 계산 및 호출 시점

**날짜:** 2025-12-21 08:04:38
**주제:** `BaseStrategy` 내 TP/SL 계산 메서드의 설계 의도 및 트레이딩 시스템 표준 검토

---

## 1. 현재 프로젝트 설계 의도 (TP/SL 호출 시점)

현재 프로젝트의 `BaseStrategy` 및 관련 모델의 설계는 **시그널 생성 시점에 TP(Take Profit)와 SL(Stop Loss)을 함께 확정하는 방식**을 채택하고 있습니다.

### 주요 근거
- **`BaseStrategy` 인터페이스:** `analyze` 메서드의 가이드라인([base.py:L213](file:///Users/osangwon/github/ict_2025/src/strategies/base.py#L213))에서 조건 충족 시 계산된 TP/SL을 포함하여 `Signal`을 생성할 것을 명시하고 있습니다.
- **`Signal` 모델의 필수 속성:** `src/models/signal.py`의 `Signal` 객체는 익절가와 손절가를 필수 필드로 가집니다. 이는 시그널이 리턴되는 시점에 이미 리스크 관리 계획이 확정되어 있어야 함을 의미합니다.
- **구현 사례:** `MockSMACrossoverStrategy` 등 실제 구현체에서도 `Signal` 객체 생성 시점에 `calculate_take_profit`과 `calculate_stop_loss`를 호출하여 값을 채웁니다.

---

## 2. 트레이딩 시스템 설계의 보편성 검토

### 2.1 진입 시점 TP/SL 확정 (리스크 중심 설계) - **현재 방식**
자동매매 시스템에서 가장 보편적이고 권장되는 방식입니다.

- **장점:**
    - **손익비(R:R) 검증:** 진입 전에 리스크 대비 보상이 적절한지 판단하여 부적절한 거래를 사전에 필터링할 수 있습니다.
    - **시스템 안정성:** 거래소에 주문을 보낼 때 익절/손절을 함께 거는 'Bracket Order'가 가능해져, 시스템 장애 시에도 자산을 보호할 수 있습니다.
- **적용:** 추세 추종, 패턴 트레이딩 등 대부분의 알고리즘 전략.

### 2.2 진입 후 동적 관리 (동적 관리 설계)
포지션 생성 이후에 별도 로직으로 TP/SL을 결정하거나 관리하는 방식입니다.

- **특징:** 시장 변화에 유연하게 대응할 수 있지만, 리스크 노출 시간이 발생하고 시스템 복잡도가 증가합니다.
- **현업의 방식:** 진입 시점에 최소한의 '안전벨트'로서 TP/SL을 먼저 설정하고, 포지션 유지 단계에서 시장 상황에 따라 이를 **수정(Modify)**하는 절충안을 주로 사용합니다.

---

## 3. 결론 및 제언

현재 프로젝트의 **"시그널 생성 시 TP/SL 동시 확정"** 구조는 리스크 관리의 엄격함과 시스템 안정성 측면에서 매우 우수한 설계입니다. 

향후 동적 관리가 필요한 경우에도 현재의 구조를 유지하되, 포지션 생성 후 `PositionManager` 또는 전략의 `on_tick` 로직을 통해 기존에 설정된 TP/SL을 유리한 방향으로 업데이트하는 방식으로 확장하는 것을 권장합니다.
