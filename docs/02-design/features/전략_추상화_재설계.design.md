# Feature Design: 전략 추상화 재설계

## 1. 개요 (Overview)
본 문서는 기존 monolith 전략에서 composable 전략으로의 리팩토링에 따라 '전략'의 추상화 재설계 필요성을 심층 분석하고, 그 방안을 검토합니다.

## 2. 아키텍처 개요 (Architectural Overview)

### 2.1. 문제 정의 및 목표 (Problem Definition & Goal)
- **문제**: 기존 monolith 전략에서 composable 전략으로의 전환 과정에서 '전략' 추상화에 대한 재고 필요성 발생. 각 기능단(entry, exit, TP/SL 등)이 저수준의 서브 전략으로 추상화될 때, 이들을 통합 관리하고 특정 코인에 적용할 수 있는 고수준의 단일 전략 추상화 방안 부재.
- **목표**:
    - '전략' 추상화 재설계의 필요성 및 이점 분석.
    - 저수준 서브 전략(예: EntryStrategy, ExitStrategy, TP/SLStrategy)과 고수준 단일 전략(예: CoinSpecificTradingStrategy) 간의 관계 및 구성 방안 정의.
    - 서브 전략의 조합 및 주입을 통한 유연하고 확장 가능한 전략 시스템 설계.

### 2.2. 제안 아키텍처 (Proposed Architecture)

#### 2.2.1. 서브 전략 (Sub-Strategies)
- 각 기능단(진입, 청산, TP/SL 등)을 독립적인 저수준 전략 모듈로 추상화합니다.
- 예시: `EntryStrategy`, `ExitStrategy`, `TakeProfitStrategy`, `StopLossStrategy`
- 각 서브 전략은 특정 기능에 집중하며, 자체적인 로직을 가집니다.

#### 2.2.2. 고수준 단일 전략 (High-Level Single Strategy)
- 특정 코인에 적용될 전체 매매 로직을 대표하는 고수준의 전략을 추상화합니다.
- 이 전략은 필요한 서브 전략들을 주입(Injection)받아 구성됩니다.
- 예시: `BitcoinTradingStrategy`, `EthereumTradingStrategy`
- 특징:
    - **컴포지션 (Composition)**: 여러 서브 전략을 조합하여 하나의 고수준 전략을 구성합니다.
    - **유연성**: 서브 전략의 교체 또는 조합 변경만으로 새로운 고수준 전략을 쉽게 생성할 수 있습니다.
    - **재사용성**: 저수준 서브 전략은 여러 고수준 전략에서 재사용될 수 있습니다.

### 2.3. 구성 요소 및 관계 (Components & Relationships)
- **Strategy Interface**: 모든 전략(서브 및 고수준)이 따르는 공통 인터페이스 정의 (예: `execute(context)`, `evaluate(data)`).
- **Strategy Factory/Builder**: 고수준 전략 객체를 생성하고, 필요한 서브 전략을 주입하는 역할을 담당.
- **Dependency Injection Mechanism**: 서브 전략을 고수준 전략에 주입하는 메커니즘 (예: 생성자 주입, 세터 주입).

## 3. 상세 설계 (Detailed Design)

### 3.1. 전략 인터페이스 정의 (Strategy Interface Definition)
- `IStrategy` (또는 `AbstractStrategy`): `execute(data_context)` 메서드 등을 포함.

### 3.2. 서브 전략 구현 예시 (Sub-Strategy Implementation Examples)
- **EntryStrategy**: 특정 조건(예: 이동평균선 교차, RSI 과매도) 충족 시 진입 시그널 생성.
- **ExitStrategy**: 포지션 종료 조건(예: 목표 수익률 달성, 손절 라인 도달) 충족 시 청산 시그널 생성.

### 3.3. 고수준 전략 구성 예시 (High-Level Strategy Composition Example)
- `CoinSpecificStrategy`: 생성자를 통해 `EntryStrategy`, `ExitStrategy`, `TakeProfitStrategy`, `StopLossStrategy` 인스턴스를 주입받음.
- `execute` 메서드 내에서 주입된 서브 전략들을 순차적으로 호출하거나 조건부로 실행.

## 4. 마이그레이션 전략 (Migration Strategy)
- **단계적 전환**: 기존 모노리식 전략에서 핵심 기능 단위를 서브 전략으로 분리하고, 이를 조합하여 고수준 전략을 구성하는 방식으로 점진적 전환.
- **테스트 주도 개발**: 각 서브 전략 및 고수준 전략의 변경 사항에 대해 철저한 테스트 케이스를 작성하여 안정성 확보.

## 5. 테스트 계획 (Test Plan)
- **단위 테스트**: 각 서브 전략 및 고수준 전략의 개별 로직에 대한 테스트.
- **통합 테스트**: 여러 서브 전략이 조합된 고수준 전략이 예상대로 동작하는지 확인.
- **백테스팅**: 재설계된 전략 시스템이 과거 데이터에 대해 유효한 성능을 보이는지 검증.

## 6. 보안 및 에러 처리 (Security & Error Handling)
- 전략 실행 중 발생할 수 있는 예외 처리 메커니즘.
- 잘못된 전략 조합 또는 주입 방지를 위한 유효성 검사.

## 7. 리스크 및 완화 (Risks & Mitigation)
- **리스크**: 과도한 추상화로 인한 복잡성 증가, 성능 오버헤드, 전략 간의 상호작용 예측 어려움.
- **완화**: 명확한 책임 분리, 인터페이스 간결화, 충분한 문서화, 성능 벤치마크 수행.

---