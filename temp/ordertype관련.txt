[퍼플렉시티 답변]


바이낸스 공식 문서에서, 말씀하신 내용이 그대로 명시되어 있습니다.

## 공식 변경 내역(Conditional → Algo Service)

바이낸스 Derivatives Change Log에 다음과 같이 기재되어 있습니다. [developers.binance](https://developers.binance.com/docs/derivatives/change-log)

> Effective on **2025-12-09**, USDⓈ-M Futures will migrate conditional orders to the Algo Service, which will affect the following order types:  
> `STOP_MARKET` / `TAKE_PROFIT_MARKET` / `STOP` / `TAKE_PROFIT` / `TRAILING_STOP_MARKET`. [developers.binance](https://developers.binance.com/docs/derivatives/change-log)

그리고 동일 문서에서 새 REST 엔드포인트로 다음을 안내합니다. [developers.binance](https://developers.binance.com/docs/derivatives/change-log)

- `POST /fapi/v1/algoOrder` : Place an algo order  
- `DELETE /fapi/v1/algoOrder` : Cancel an algo order  
- `GET /fapi/v1/algoOrder` : Query an algo order  
- `GET /fapi/v1/openAlgoOrders` : Query algo open order(s)  
- `GET /fapi/v1/allAlgoOrders` : Query algo order(s) [developers.binance](https://developers.binance.com/docs/derivatives/change-log)

즉:

- `STOP_MARKET`, `TAKE_PROFIT_MARKET`, `STOP`, `TAKE_PROFIT`, `TRAILING_STOP_MARKET` 같은 **conditional order type**은 이제 `/fapi/v1/algoOrder`로 보내야 하고, [developers.binance](https://developers.binance.com/docs/derivatives/change-log)
- 이때 `type` 필드에는 위에 열거된 바이낸스 정의 그대로의 문자열 값만 사용할 수 있습니다. [developers.binance](https://developers.binance.com/docs/derivatives/change-log)

따라서 `binance_service.py`의 `new_algo_order(..., type: str, ...)`에서 사용하는 `type` 파라미터는,  
바이낸스 Derivatives 문서에서 지정한 **공식 order type 상수(문자열)**를 정확히 따르는 것이 맞습니다.

질문하신 관점이 상당히 합리적인데, 바이낸스 구현을 보면 “이론적으로는 가능하지만, 실제로는 구분해 둔 이유가 있다” 정도로 정리할 수 있습니다. [binance](https://www.binance.com/en/square/post/43147)

## 1. 이론적 관점: 가격 세팅만으로도 용도 구분은 가능

- 트레이딩 이론상,  
  - 롱 포지션 손절: 진입가 아래로 트리거/지정가 설정  
  - 롱 포지션 익절: 진입가 위로 트리거/지정가 설정  
  - 숏 포지션은 반대로 설정  
  이런 식으로 **트리거/지정 가격 위치만으로 손절·익절 구분이 사실상 자동**으로 가능합니다.  
- 실제로 Binance 문서에서도 “Stop Order 기능 하나로 손절/익절을 모두 처리할 수 있고, 시스템이 트리거 가격 위치에 따라 stop-loss인지 take-profit인지를 판단할 수 있다”고 설명합니다. [binance](https://www.binance.com/en/support/faq/detail/360040016512)

따라서 “type은 STOP(또는 STOP_MARKET) 하나만 두고, 가격 위치로 손절/익절을 구분해도 기능적으로는 가능하지 않냐?”라는 문제 제기는 타당합니다.

## 2. Binance가 STOP과 TAKE_PROFIT을 나누는 실무적 이유

하지만 바이낸스는 다음과 같은 이유로 `STOP` / `TAKE_PROFIT`(및 `_MARKET`)을 **명시적으로 분리**해 두고 있습니다. [binance](https://www.binance.com/en/academy/articles/what-order-types-can-you-use-on-binance)

1. **포지션 감소 전용(reduce-only) 제약 차이**  
   - 바이낸스 설명을 보면, **Take Profit Limit/Market 주문은 “오픈 포지션을 감소시키는 용도로만” 사용된다**고 명시합니다. [binance](https://www.binance.com/lv/blog/futures/8534557745009080271)
   - 즉, TAKE_PROFIT 계열은 구조적으로 **포지션 축소/청산용**으로 설계되어 있고, 신규 포지션 오픈용으로 쓰지 않는 것을 전제로 합니다.  
   - STOP 계열은 손절 위주이지만, 설계상 더 일반적인 스톱 기반 주문으로 취급됩니다.  

2. **리스크 관리 및 UI/UX 차별화**  
   - 프론트 UI에서 “손절(SL)”과 “익절(TP)”를 명확히 구분해서 보여주고, 각기 다른 색상·레이블로 표시합니다. [binance](https://www.binance.com/en/support/faq/detail/360033779452)
   - 이때 백엔드에서도 타입이 분리되어 있으면,  
     - 리스크 엔진(포지션 감소 전용, 최대 리스크 산정 등)  
     - 주문 관리(별도의 TP/SL split target 기능 등) [binance](https://www.binance.com/en/support/faq/detail/717a9635f035490baffa564e2f19c7c1)
     를 구현할 때 훨씬 명료해집니다.  

3. **회계·로그·전략 관리 측면에서의 의미 부여**  
   - TP와 SL을 타입 수준에서 나눠 두면,  
     - 백테스트·리포팅에서 “익절로 종료된 포지션 vs 손절로 종료된 포지션”을 쉽게 집계  
     - 내부 리스크/전략 모듈에서 “익절-only, 손절-only 정책” 등을 타입 기준으로 분류  
     가 가능해집니다.  
   - 가격 위치만 가지고 사후 판정하면, 로그/리포트 단계에서 추가 연산이 필요하고, 버그 포인트가 늘어납니다.

4. **과거 스팟/선물 API와의 정합성**  
   - 과거부터 REST API의 `orderTypes`에 STOP_LOSS / TAKE_PROFIT / TAKE_PROFIT_LIMIT 등 **의미가 부여된 타입 이름**이 자리 잡혀 있었고, [stackoverflow](https://stackoverflow.com/questions/67461204/how-to-use-take-profit-property-in-binance-api)
   - 선물·알고 서비스로 확장하면서도 이 명명 규칙을 유지하는 쪽이 개발자·문서 호환성 측면에서 유리합니다.

## 3. “type에 용도를 표시할 필요가 있나?”에 대한 결론

정리하면:

- **순수 기능만 보면**  
  - 말씀하신 것처럼 “MARKET 키워드 유무로 시장가/지정가를 나누고,  
    트리거/지정가 위치로 손절·익절을 판정”하는 API 설계도 충분히 가능합니다.  
- **하지만 바이낸스는**  
  - 리스크 제약(포지션 감소 전용),  
  - UI/로그/리포트에서의 의미 명시,  
  - 기존 스펙과의 정합성  
  등을 위해 **type 이름 자체에 용도(SL/TP)를 인코딩**하는 쪽을 선택한 것으로 보는 것이 합리적입니다. [binance](https://www.binance.com/en/square/post/43147)

즉, “순수 설계 관점에서 type에 용도를 굳이 넣을 필요는 없다”는 견해는 일리가 있지만,  
바이낸스는 **도메인 의미가 드러나는 명시적 타입(STOP vs TAKE_PROFIT)**을 줌으로써,  
위와 같은 운영·리스크·UX 이점을 얻고 있다고 이해하시면 될 것 같습니다.

간단히 말해, **type과 다른 방향으로 가격 파라미터를 준다고 해서 바로 에러가 나는 것은 아니고**, 시스템이 “손절/익절 판정”을 가격 위치로 다시 판단하는 구조입니다. 다만, 몇 가지 제약·에러 포인트는 있습니다. [binance](https://www.binance.com/en/support/faq/detail/360040016512)

## 1. 시스템은 실제론 가격 위치로 SL/TP를 판정

- 바이낸스 공식 FAQ에서 “하나의 Stop Order 타입으로도, **트리거 가격이 현재가 위/아래 어디에 있느냐에 따라 stop-loss인지 take-profit인지 시스템이 결정한다**”고 명시합니다. [binance](https://www.binance.com/en/support/faq/how-to-place-stop-loss-and-take-profit-orders-on-binance-futures-360040016512)
- 즉, `type`이 `STOP`이든 `TAKE_PROFIT`이든,  
  - 트리거 가격이 진입가/현재가 위면 익절,  
  - 아래면 손절  
  로 해석하는 로직이 내부에 존재합니다. [binance](https://www.binance.com/en/support/faq/detail/360040016512)

그래서 “롱 포지션인데 `TAKE_PROFIT`이라고 해놓고, 트리거를 진입가보다 아래로 주는” 식의 설정을 했다고 해서, **형식 불일치만으로 즉시 오류(-4xxx)를 던지는 구조는 아닙니다.**

## 2. 언제 에러가 나는가: 형식이 아니라 “유효성” 문제

실제 에러는 **타입–엔드포인트 호환성이나 값 자체의 유효성**에서 납니다.

- 지원하지 않는 타입을 잘못된 엔드포인트에 보내면  
  - 예: `/fapi/v1/order`에 conditional 전용 타입을 보내는 경우 `-4120 STOP_ORDER_SWITCH_ALGO` 등 발생. [developers.binance](https://developers.binance.com/docs/derivatives/usds-margined-futures/error-code)
- 가격 필터 위반, activation price 잘못 등은  
  - `-4135 INVALID_ACTIVATION_PRICE` 등으로 거부됩니다. [developers.binance](https://developers.binance.com/docs/derivatives/usds-margined-futures/error-code)
- 하지만 “롱인데 TAKE_PROFIT인데 가격이 아래에 있다” 같이 **의미상 어색한 조합**은, 문서상 명시된 오류 코드는 없고, 시스템이 그냥 stop-loss로 해석하여 처리하는 구조입니다. [binance](https://www.binance.com/en/support/faq/how-to-place-stop-loss-and-take-profit-orders-on-binance-futures-360040016512)

즉, **타입과 가격 위치가 논리적으로 안 맞는다고 해서 그것만으로 에러를 내지는 않습니다.**  
에러는 “이 타입은 이 엔드포인트에서 지원 안 한다”, “activation price가 규칙 위반이다” 같은 **형식·규칙 위반**일 때 나는 것입니다. [developers.binance](https://developers.binance.com/docs/derivatives/usds-margined-futures/error-code)

## 3. 그래도 type을 의미에 맞게 쓰는 이유

하지만 실무적으로는 다음 이유 때문에 **type과 가격 세팅을 일관되게 쓰는 것이 안전합니다.**

- TP/SL 전용 기능, 포지션 감소 전용(reduce-only) 정책 등은 보통 **TAKE_PROFIT 계열은 이익 실현, STOP 계열은 손실 제한**으로 가정하고 설계됩니다. [binance](https://www.binance.bh/en-BH/support/faq/detail/e1ee1738141c49718550fa9061be4bf3)
- 리포팅·로그·전략 코드에서 “이 주문은 TP냐 SL이냐”를 **type** 기준으로 분류하는 경우가 많아, 의미를 뒤틀어 쓰면 나중에 통계/전략 분석이 꼬입니다.  
- 향후 바이낸스가 “type과 가격 위치가 모순되는 조합”에 대해 검증을 강화할 가능성도 배제할 수 없습니다.

***

요약하면:

- **단지 type과 가격 파라미터 방향이 어긋났다는 이유만으로 즉시 에러가 나는 것은 아니다.** [binance](https://www.binance.com/en/support/faq/detail/360040016512)
- 에러는 주로 “엔드포인트가 지원하지 않는 type 사용”이나 “activation price/필터 위반”에서 발생한다. [developers.binance](https://developers.binance.com/docs/derivatives/usds-margined-futures/error-code)
- 하지만 도메인 의미와 내부/외부 로직(리스크, 리포트)을 고려하면, **type은 가급적 용도에 맞게 STOP vs TAKE_PROFIT으로 명확히 구분해서 사용하는 것이 바람직**합니다.










